```{r chapter-5-setup, cache = FALSE, echo = FALSE, message = FALSE, warning = FALSE}

library(data.table)
library(tidyverse)
library(hrbrthemes)
library(ggcorrplot)
library(GoodmanKruskal)
library(lindia)
library(finalfit)
library(sigr)
library(papaja)
library(here)
library(kableExtra)
library(GGally)
library(gtools)
library(MASS)
library(corrplot)
library(magrittr)
library(caret)
library(factoextra)
library(broom)
library(ggord)
library(skimr)
library(sjstats)
library(explor)
library(stargazer)
# For overriding MASS select() 
select <- dplyr::select
set.seed(2018)
```


# Week 6 â€“ Analysis of longitudinal data


```{r chapter-8-generic-instruction, echo = FALSE}
# Implement the analyses of Chapter 8 of MABS using the RATS data. (0-7 points)
```


```{r chapter6-load-data, echo = FALSE}

rats <- read.csv(here("data/rats.csv"))

rats %<>% mutate(
  id = factor(id),
  group = factor(group),
  weeks = factor(weeks)
)


```

```{r rats-overview, echo = FALSE}
skim(rats)
```


## Figure 8.1

```{r rats-81, echo = false}
ggplot(rats, aes(x = time, y = rats, linetype = id)) + 
  geom_line() + scale_linetype_manual(values = rep(1:10, times=4)) + 
  facet_grid(. ~ group, labeller = label_both) +
  theme_minimal() + theme(legend.position = "none") +
  theme(panel.grid.minor.y = element_blank()) +
  scale_y_continuous(limits = c(min(rats$rats), max(rats$rats)))

```
\pagebreak

## Figure 8.2

```{r rats-82, echo=false}
# Standardise the scores:
rats_standardized <- rats %>%
  group_by(time) %>%
  mutate(stdrats = (rats - mean(rats))/sd(rats)) %>%
  ungroup()

skim(rats_standardized)
ggplot(rats_standardized , aes(x = time, y = stdrats, linetype = id)) + 
  geom_line() + scale_linetype_manual(values = rep(1:10, times = 4)) +
  facet_grid(. ~ group, labeller = label_both) +
  theme_minimal() + theme(legend.position = "none") +
  theme(panel.grid.minor.y = element_blank()) +
  scale_y_continuous(name = "standardized rats")

```
\pagebreak

## Figure 8.3

```{r rats-83, echo=false}
# Make a summary data:
n <- length(0:8) # weeks, incl. baseline (0)
rats_summary <- rats %>%
  group_by(group, time) %>%
  summarise(mean = mean(rats), se = sd(rats)/sqrt(n)) %>%
  ungroup()

skim(rats_summary)

ggplot(rats_summary, aes(x = time, y = mean, linetype = group, shape = group)) +
  geom_line() + scale_linetype_manual(values = c(1,2,3)) +
  geom_point(size = 3) + scale_shape_manual(values = c(1,2,3)) +
  geom_errorbar(aes(ymin=mean-se, ymax = mean+se, linetype = "1"), width=0.3) + 
  theme_minimal() + 
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
    ) +
  theme(legend.position = c(0.8,0.8)) +
  scale_y_continuous(name = "mean(rats) +/- se(rats)")
```
\pagebreak

## Figure 8.4

```{r Figure 8.4, echo=TRUE}
p1 <- ggplot(BPRSL, aes(x = factor(week), y = bprs, fill = treatment))
p2 <- p1 + geom_boxplot(position = position_dodge(width = 0.9))
p3 <- p2 + theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p4 <- p3 + theme(legend.position = c(0.8,0.8))
p5 <- p4 + scale_x_discrete(name = "week")
# Black & White version:
#p6 <- p5 + scale_fill_grey(start = 0.5, end = 1)
p5
```





```{r chapter9-generic-instruction, echo = FALSE}
# Implement the analyses of Chapter 9 of MABS using the BPRS data. (0-8 points)
```

